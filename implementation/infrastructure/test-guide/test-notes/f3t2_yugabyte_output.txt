                                                                                                                                                    query                                                                                                                                                    | calls |    total_time    |    mean_time     
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------+------------------+------------------
 SELECT id, seat_number, status, ticket_area_id, created_at, updated_at                                                                                                                                                                                                                                     +| 33486 |   1339886.993257 | 40.0133486608433
         FROM ticket_seats                                                                                                                                                                                                                                                                                  +|       |                  | 
         WHERE ticket_area_id = $1 and status = $3                                                                                                                                                                                                                                                          +|       |                  | 
         LIMIT $2                                                                                                                                                                                                                                                                                           +|       |                  | 
         FOR UPDATE SKIP LOCKED                                                                                                                                                                                                                                                                              |       |                  | 
 WITH event_data AS (                                                                                                                                                                                                                                                                                       +|  3659 |    498888.656477 | 136.345628990708
                 SELECT                                                                                                                                                                                                                                                                                     +|       |                  | 
                         e.id, e.name, e.location, e.description, e.created_at, e.updated_at                                                                                                                                                                                                                +|       |                  | 
                 FROM events e                                                                                                                                                                                                                                                                              +|       |                  | 
                 WHERE e.id = $1                                                                                                                                                                                                                                                                            +|       |                  | 
         ),                                                                                                                                                                                                                                                                                                 +|       |                  | 
         ticket_sales_data AS (                                                                                                                                                                                                                                                                             +|       |                  | 
                 SELECT                                                                                                                                                                                                                                                                                     +|       |                  | 
                         ts.id, ts.name, ts.sale_begin_at, ts.sale_end_at, ts.event_id,                                                                                                                                                                                                                     +|       |                  | 
                         ts.created_at, ts.updated_at                                                                                                                                                                                                                                                       +|       |                  | 
                 FROM ticket_sales ts                                                                                                                                                                                                                                                                       +|       |                  | 
                 WHERE ts.event_id = $1                                                                                                                                                                                                                                                                     +|       |                  | 
         ),                                                                                                                                                                                                                                                                                                 +|       |                  | 
         ticket_packages_data AS (                                                                                                                                                                                                                                                                          +|       |                  | 
                 SELECT                                                                                                                                                                                                                                                                                     +|       |                  | 
                         tp.id, tp.price, tp.ticket_category_id, tp.ticket_sale_id,                                                                                                                                                                                                                         +|       |                  | 
                         tp.created_at, tp.updated_at                                                                                                                                                                                                                                                       +|       |                  | 
                 FROM ticket_packages tp                                                                                                                                                                                                                                                                    +|       |                  | 
                 JOIN ticket_sales ts ON tp.ticket_sale_id = ts.id                                                                                                                                                                                                                                          +|       |                  | 
                 WHERE ts.event_id = $1                                                                                                                                                                                                                                                                     +|       |                  | 
         ),                                                                                                                                                                                                                                                                                                 +|       |                  | 
         ticket_categories_data AS (                                                                                                                                                                                                                                                                        +|       |                  | 
                 SELECT                                                                                                                                                                                                                                                                                     +|       |                  | 
                         tc.id, tc.name, tc.event_id, tc.created_at, tc.updated_at                                                                                                                                                                                                                          +|       |                  | 
                 FROM ticket_categories tc                                                                                                                                                                                                                                                                  +|       |                  | 
                 WHERE tc.event_id = $1                                                                                                                                                                                                                                                                     +|       |                  | 
         ),                                                                                                                                                                                                                                                                                                 +|       |                  | 
         ticket_areas_data AS (                                                                                                                                                                                                                                                                             +|       |                  | 
                 SELECT                                                                                                                                                                                                                                                                                     +|       |                  | 
                         ta.id, ta.type, ta.ticket_package_id, ta.created_at, ta.updated_at                                                                                                                                                                                                                 +|       |                  | 
                 FROM ticket_areas ta                                                                                                                                                                                                                                                                       +|       |                  | 
                 JOIN ticket_packages tp ON ta.ticket_package_id = tp.id                                                                                                                                                                                                                                    +|       |                  | 
                 JOIN ticket_sales ts ON tp.ticket_sale_id = ts.id                                                                                                                                                                                                                                          +|       |                  | 
                 WHERE ts.event_id = $1                                                                                                                                                                                                                                                                     +|       |                  | 
         )                                                                                                                                                                                                                                                                                                  +|       |                  | 
         SELECT                                                                                                                                                                                                                                                                                             +|       |                  | 
                 json_build_object(                                                                                                                                                                                                                                                                         +|       |                  | 
                         $2, e.id,                                                                                                                                                                                                                                                                          +|       |                  | 
                         $3, e.name,                                                                                                                                                                                                                                                                        +|       |                  | 
                         $4, e.location,                                                                                                                                                                                                                                                                    +|       |                  | 
                         $5, e.description,                                                                                                                                                                                                                                                                 +|       |                  | 
                         $6, e.created_at,                                                                                                                                                                                                                                                                  +|       |                  | 
                         $7, e.updated_at,                                                                                                                                                                                                                                                                  +|       |                  | 
                         $8, COALESCE(                                                                                                                                                                                                                                                                      +|       |                  | 
                                 (                                                                                                                                                                                                                                                                          +|       |                  | 
                                         SELECT json_agg(                                                                                                                                                                                                                                                   +|       |                  | 
                                                 json_build_object(                                                                                                                                                                                                                                         +|       |                  | 
                                                         $9, ts.id,                                                                                                                                                                                                                                         +|       |                  | 
                                                         $10, ts.name,                                                                                                                                                                                                                                      +|       |                  | 
                                                         $11, ts.sale_begin_at,                                                                                                                                                                                                                             +|       |                  | 
                                                         $12, ts.sale_end_at,                                                                                                                                                                                                                               +|       |                  | 
                                                         $13, ts.event_id,                                                                                                                                                                                                                                  +|       |                  | 
                                                         $14, ts.created_at,                                                                                                                                                                                                                                +|       |                  | 
                                                         $15, ts.updated_at,                                                                                                                                                                                                                                +|       |                  | 
                                                         $16, COALESCE(                                                                                                                                                                                                                                     +|       |                  | 
                                                                 (                                                                                                                                                                                                                                          +|       |                  | 
                                                                         SELECT json_agg(                                                                                                                                                                                                                   +|       |                  | 
                                                                                 json_build_object(                                                                                                                                                                                                         +|       |                  | 
                                                                                         $17, tp.id,                                                                                                                                                                                                        +|       |                  | 
                                                                                         $18, tp.price,                                                                                                                                                                                                     +|       |                  | 
                                                                                         $19, tp.ticket_category_id,                                                                                                                                                                                        +|       |                  | 
                                                                                         $20, tp.ticket_sale_id,                                                                                                                                                                                            +|       |                  | 
                                                                                         $21, tp.created_at,                                                                                                                                                                                                +|       |                  | 
                                                                                         $22, tp.updated_at,                                                                                                                                                                                                +|       |                  | 
                                                                                         $23, (                                                                                                                                                                                                             +|       |                  | 
                                                                                                 SELECT json_build_object(                                                                                                                                                                                  +|       |                  | 
                                                                                                         $24, tc.id,                                                                                                                                                                                        +|       |                  | 
                                                                                                         $25, tc.name,                                                                                                                                                                                      +|       |                  | 
                                                                                                         $26, tc.event_id,                                                                                                                                                                                  +|       |                  | 
                                                                                                         $27, tc.created_at,                                                                                                                                                                                +|       |                  | 
                                                                                                         $28, tc.updated_at                                                                                                                                                                                 +|       |                  | 
                                                                                                 )                                                                                                                                                                                                          +|       |                  | 
                                                                                                 FROM ticket_categories_data tc                                                                                                                                                                             +|       |                  | 
                                                                                                 WHERE tc.id = tp.ticket_category_id                                                                                                                                                                        +|       |                  | 
                                                                                         ),                                                                                                                                                                                                                 +|       |                  | 
                                                                                         $29, COALESCE(                                                                                                                                                                                                     +|       |                  | 
                                                                                                 (                                                                                                                                                                                                          +|       |                  | 
                                                                                                         SELECT json_agg(                                                                                                                                                                                   +|       |                  | 
                                                                                                                 json_build_object(                                                                                                                                                                         +|       |                  | 
                                                                                                                         $30, ta.id,                                                                                                                                                                        +|       |                  | 
                                                                                                                         $31, ta.type,                                                                                                                                                                      +|       |                  | 
                                                                                                                         $32, ta.ticket_package_id,                                                                                                                                                         +|       |                  | 
                                                                                                                         $33, ta.created_at,                                                                                                                                                                +|       |                  | 
                                                                                                                         $34, ta.updated_at                                                                                                                                                                 +|       |                  | 
                                                                                                                 )                                                                                                                                                                                          +|       |                  | 
                                                                                                         )                                                                                                                                                                                                  +|       |                  | 
                                                                                                         FROM ticket_areas_data ta                                                                                                                                                                          +|       |                  | 
                                                                                                         WHERE ta.ticket_package_id = tp.id                                                                                                                                                                 +|       |                  | 
                                                                                                 ),                                                                                                                                                                                                         +|       |                  | 
                                                                                                 $35::json                                                                                                                                                                                                  +|       |                  | 
                                                                                         )                                                                                                                                                                                                                  +|       |                  | 
                                                                                 )                                                                                                                                                                                                                          +|       |                  | 
                                                                         )                                                                                                                                                                                                                                  +|       |                  | 
                                                                         FROM ticket_packages_data tp                                                                                                                                                                                                       +|       |                  | 
                                                                         WHERE tp.ticket_sale_id = ts.id                                                                                                                                                                                                    +|       |                  | 
                                                                 ),                                                                                                                                                                                                                                         +|       |                  | 
                                                                 $36::json                                                                                                                                                                                                                                  +|       |                  | 
                                                         )                                                                                                                                                                                                                                                  +|       |                  | 
                                                 )                                                                                                                                                                                                                                                          +|       |                  | 
                                         )                                                                                                                                                                                                                                                                  +|       |                  | 
                                         FROM ticket_sales_data ts                                                                                                                                                                                                                                          +|       |                  | 
                                 ),                                                                                                                                                                                                                                                                         +|       |                  | 
                                 $37::json                                                                                                                                                                                                                                                                  +|       |                  | 
                         )                                                                                                                                                                                                                                                                                  +|       |                  | 
                 ) as event_json                                                                                                                                                                                                                                                                            +|       |                  | 
         FROM event_data e                                                                                                                                                                                                                                                                                   |       |                  | 
 INSERT INTO orders(external_user_id, ticket_area_id, status, ticket_sale_id, event_id)                                                                                                                                                                                                                     +| 85034 | 484130.972399996 | 5.69338114636497
         VALUES ($1, $2, $5, $3, $4)                                                                                                                                                                                                                                                                        +|       |                  | 
         RETURNING *                                                                                                                                                                                                                                                                                         |       |                  | 
 UPDATE ticket_seats                                                                                                                                                                                                                                                                                        +| 85121 | 260052.897884998 | 3.05509683726698
         SET status = $3                                                                                                                                                                                                                                                                                    +|       |                  | 
         WHERE ticket_area_id = $1 and id = ANY($2) and status = $4                                                                                                                                                                                                                                          |       |                  | 
 SELECT id, seat_number, status, ticket_area_id, created_at, updated_at                                                                                                                                                                                                                                     +| 51842 |    161624.214748 | 3.11763077713054
         FROM ticket_seats                                                                                                                                                                                                                                                                                  +|       |                  | 
         WHERE ticket_area_id = $1 and id = ANY($2) and status = $3                                                                                                                                                                                                                                         +|       |                  | 
         FOR UPDATE NOWAIT                                                                                                                                                                                                                                                                                   |       |                  | 
 INSERT INTO order_items(customer_name, customer_email, price, order_id, ticket_seat_id, ticket_category_id, ticket_area_id) VALUES                                                                                                                                                                         +| 40896 |     133929.57887 | 3.27488211243152
     ($1, $2, $3, $4, $5, $6, $7), ($8, $9, $10, $11, $12, $13, $14) RETURNING id, customer_name, customer_email, price, order_id, ticket_seat_id, ticket_category_id, created_at, updated_at                                                                                                                |       |                  | 
 INSERT INTO order_items(customer_name, customer_email, price, order_id, ticket_seat_id, ticket_category_id, ticket_area_id) VALUES                                                                                                                                                                         +| 25133 | 84453.2307930003 | 3.36025268742291
     ($1, $2, $3, $4, $5, $6, $7) RETURNING id, customer_name, customer_email, price, order_id, ticket_seat_id, ticket_category_id, created_at, updated_at                                                                                                                                                   |       |                  | 
 SELECT *                                                                                                                                                                                                                                                                                                   +|   207 |     45128.812207 | 218.013585541063
         FROM ticket_seats                                                                                                                                                                                                                                                                                  +|       |                  | 
         WHERE ticket_area_id = $1                                                                                                                                                                                                                                                                          +|       |                  | 
         ORDER BY seat_number                                                                                                                                                                                                                                                                                |       |                  | 
 copy "ticket_seats" ( "seat_number", "status", "ticket_area_id" ) from stdin binary                                                                                                                                                                                                                         |   640 |     31026.757815 | 48.4793090859375
 INSERT INTO order_items(customer_name, customer_email, price, order_id, ticket_seat_id, ticket_category_id, ticket_area_id) VALUES                                                                                                                                                                         +|  6154 | 19411.5187010001 | 3.15429293158921
     ($1, $2, $3, $4, $5, $6, $7), ($8, $9, $10, $11, $12, $13, $14), ($15, $16, $17, $18, $19, $20, $21), ($22, $23, $24, $25, $26, $27, $28), ($29, $30, $31, $32, $33, $34, $35) RETURNING id, customer_name, customer_email, price, order_id, ticket_seat_id, ticket_category_id, created_at, updated_at |       |                  | 
(10 rows)

